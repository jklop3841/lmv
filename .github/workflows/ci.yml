test-windows:
  runs-on: windows-latest
  timeout-minutes: 20
  env:
    LMV_PASSPHRASE: "ci-test-passphrase"
    LMV_WRITE_TOKEN: ""
  steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Node
      uses: actions/setup-node@v4
      with:
        node-version: 20
        cache: npm

    - name: Install
      run: npm ci

    - name: Build
      run: npm run build

    - name: Integration Tests (capture log)
      shell: pwsh
      run: |
        npm run test:integration *>&1 | Tee-Object integration.log

    - name: Upload integration log
      uses: actions/upload-artifact@v4
      with:
        name: integration-log-windows
        path: integration.log